# -*- perl -*-
### ユーザ設定項目 ### {{{1

# --------------------------------------------------------------------
# 日記の名前
$changelog_name = "memo.xight.org";

# --------------------------------------------------------------------
# ChangeLog を公開する URL (絶対 URL を強く推奨) - RSS に必要
# 例: $clog_url = "http://chalow.net/";
$clog_url = "http://memo.xight.org/";		# 必ず URL を設定して下さい

# --------------------------------------------------------------------
# インデックスページ (index.html) で最近何日分を表示するか
# (コマンドラインオプション "-n" でも指定できます)
$opt_topn = 7;

# --------------------------------------------------------------------
# 日ごとにページを作るか (0:NO, 1:YES) --- obsolete
#$day_page_mode = 1;

# --------------------------------------------------------------------
# 作成するページの単位 (0:月, 1:日, 2:アイテム)
$page_mode = 2;

# --------------------------------------------------------------------
# 自動文字列置換
$auto_replace = '
s!(<blockquote>)!</p>$1!g;
s!(</blockquote>)!$1<p>!g;
s|\$\$(.+?)\$\$|qq(<img src="http://xight.org/cgi-bin/mimetex.cgi?$1" />)|gmes;
';
#s!(chalow)(<|\s|[\x80-\xff]|$)!<a href="http://nais.to/~yto/tools/chalow/">$1</a>$2!g;

# --------------------------------------------------------------------
# ファイルの最初に出てくる「<!-- ReplaceOnce -->」を置き換える文字列
$replace_once = << "__REPLACE_ONCE"
<!-- 広告とか -->
__REPLACE_ONCE
    ;

# --------------------------------------------------------------------
# CSS ファイル
$css_file = "";
#$css_file = "/~yoshiki/common/chalow.css";
#$css_file = "clover/clover.css";

my $css_html = << "___CSS_HTML"
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">
	<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
	<link rel="stylesheet" href="/common/twentyeleven.css" type="text/css" />
	<link rel="stylesheet" href="/common/keys.css" type="text/css" />
	<link rel="stylesheet" href="/common/custom.css" type="text/css" />
___CSS_HTML
;

# --------------------------------------------------------------------
# RSSファイル名
#$rss_filename = "cl.rdf";
$rss_filename = "rss.xml";

# --------------------------------------------------------------------
# RSSに最近何日分表示するか(0の場合は $opt_topn と同じ)
$rss_topn = 0;

# --------------------------------------------------------------------
# 日付の後に曜日(Mon, Tue, ...)を表示するか (1:yes or 0:no)
$show_day_of_week = 1;

# --------------------------------------------------------------------
# 月ページで、日付を降順 (新しい日付が上) で表示するか (1:yes or 0:no)
$reverse_order_days = 1;

# --------------------------------------------------------------------
# アイテムヘッダーのフォーマットをどうするか
# (0:"* HOGE:", 1:"* HOGE", 2:"HOGE:",3:"HOGE")
$item_header_style = 3;

# --------------------------------------------------------------------
# 表示するとき引用記号 ('>' or '|') を消すか (1:YES, 0:NO)
$remove_quote_mark = 1;

# --------------------------------------------------------------------
# item header で h3 タグを使うか (1:YES, 0:NO) - tDiary との互換性のため
$use_h3_for_item_header = 1;

# --------------------------------------------------------------------
# item header の先頭の記号にアンカーをつけるか (1:YES, 0:NO)
$use_item_anchor = 1;

# --------------------------------------------------------------------
# item header の先頭の記号の指定
# 『日記のセクションの先頭(サブタイトルの行頭)に挿入される、リンク用の
# アンカー文字列を指定します。なお「<span class="panchor">_</span>」を
# 指定すると、テーマによっては自動的に画像アンカーがつくようになりま
# す。』(tDiary の skel/conf.rhtml より)
# $item_header_mark = qq(<span class="sanchor">■</span>);
$item_header_mark = qq();

# --------------------------------------------------------------------
# RSS を出力するか (1:YES, 0:NO)
$output_rss = 1;

# --------------------------------------------------------------------
# 日記の説明 for RSS : 例: "日々のあれこれ。"
$changelog_description = "Changelogメモによる日々のメモ";

# --------------------------------------------------------------------
# 他の年の同じ日付 (月日) へのリンクを張るか (1:YES, 0:NO)
$same_date_jump = 1;

# --------------------------------------------------------------------
# 日付一覧をカレンダー表示にするか (1:YES, 0:NO)
$calendar_style = 0;

# --------------------------------------------------------------------
# 検索用ファイル (cl.itemlist) を作るか (1:YES, 0:NO)
$output_itemlist = 1;

# --------------------------------------------------------------------
# 見出し一覧 (JavaScript ファイル) で出力する日数
$latest_titles_num = 7;

# --------------------------------------------------------------------
# カテゴリページを作るか (0:NO, 1:YES)
$output_cat_pages = 1;

# --------------------------------------------------------------------
# カテゴリページ中のエントリ数の上限
# ($output_cat_pages = 1 のときのみ有効)
$cat_page_entry_max = 20;

# --------------------------------------------------------------------
# カテゴリ別item表示のためのCGIを指定する（カテゴリ名は %%CAT%% で置き換え）
# ($output_cat_pages = 0 のときのみ有効)
$cat_page_cgi = "clsearch.cgi?cat=%%CAT%%";
#$cat_page_cgi = "";

# }}}1

## テンプレート #### {{{1

# (サイドメニュー、サイドバー)
my $side_menu = << "___SIDE_MENU"
<!-- sidemenu -->
<aside id="recent-posts-3" class="widget widget_recent_entries">
<h3 class="widget-title">最近の投稿</h3>
<script type="text/javascript" src="recent-posts.js"></script>
</aside>

<aside id="recent-posts-3" class="widget widget_recent_entries">
<h3 class="widget-title">misc.</h3>
<ul>
	<li><a href="http://twitter.com/xight">twitter</a></li>
	<li><a href="http://memo.xight.org/rss.xml">RSS</a></li>
	<li><a href="http://feedmeter.net/detail.php?r=http%3A%2F%2Fmemo.xight.org%2Frss.xml"><img src="http://feedmeter.net/image.php?r=http%3A%2F%2Fmemo.xight.org%2Frss.xml" width="60" height="36" alt="RSS feed meter for http://memo.xight.org/" /></a></li>
</ul>
</aside>

<aside id="links-3" class="widget widget_links">
<h3 class="widget-title">リンク</h3>
<ul>
	<li><a href="http://tech-seminar.jp/">tech-seminar.jp</a></li>
	<li><a href="http://chalow.org/">chalow</a></li>
</ul>
</aside>
<!-- /sidemenu -->
___SIDE_MENU
;

# header menu (custom)
my $header_menu = << "___HEADER_MENU"
<hgroup>
<h1 id="site-title"><a href="http://memo.xight.org/"><TMPL_VAR name=cl_name></a></h1>
<h2 id="site-description">日々のメモ</h2>
</hgroup>
<form method="get" id="searchform" action="http://www.google.co.jp/cse">
	<label for="s" class="assistive-text">Search</label>
	<input type="submit" class="submit" name="submit" id="searchsubmit" value="Search">
	<input type="hidden" name="cx" value="partner-pub-9149485931275097:c2d00eu03br" />
	<input type="hidden" name="ie" value="UTF-8" />
	<input type="text" name="q" id="s" size="18" placeholder="Search" />
</form>
<script type="text/javascript" src="http://www.google.co.jp/cse/brand?form=cse-search-box&amp;lang=ja"></script> 

<nav id="access" role="navigation">
<h3 class="assistive-text">Main menu</h3>
<div class="skip-link"><a class="assistive-text" href="#content" title="Skip to primary content">Skip to primary content</a></div>
<div class="skip-link"><a class="assistive-text" href="#secondary" title="Skip to secondary content">Skip to secondary content</a></div>
<div class="menu">
<ul>
	<li class="page_item"><a href="http://xight.org/" title="Home">Home</a></li>
	<li class="current_page_item"><a href="http://memo.xight.org/" title="memo.xight.org">Memo</a></li>
	<li class="page_item"><a href="http://iv.xight.org/" title="情報視覚化">視覚化</a>
	<!--
	<ul class="children">
		<li class="page_item page-item-49"><a href="http://wp-themes.com/?page_id=49">Sub-page</a></li>
	</ul>
	-->
	</li>
</ul>
</div>
</nav>
___HEADER_MENU
    ;

# footer menu (custom)
my $footer_menu = << "___FOOTER_MENU"
<!-- footer menu -->
<div id="site-generator">
<p>
Author 佐藤 克己 (Yoshiki Sato)
Since 2002-11-28
Update <TMPL_VAR name=lastupdate>
</p>
</div>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ?
"https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost +
"google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{
	var pageTracker = _gat._getTracker("UA-164286-2");
	pageTracker._trackPageview();
	setTimeout('pageTracker._trackEvent(\\'NoBounce\\', \\'NoBounce\\', \\'Over 10 seconds\\')',10000);
} catch(err) {}
</script>

<!-- /footer menu -->
___FOOTER_MENU
    ;

my $ad_486_60 = << "___AD_468_60"
<script type="text/javascript"><!--
google_ad_client = "pub-9149485931275097";
/* xight.org top */
google_ad_slot = "6304261978";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
___AD_468_60
	;

my $ad_336_280 = << "___AD_336_280"
<script type="text/javascript"><!--
google_ad_client = "pub-9149485931275097";
/* xight.org bottom */
google_ad_slot = "9636898891";
google_ad_width = 336;
google_ad_height = 280;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
___AD_336_280
	;
	
my $ad_rakuten;
$ad_rakuten = << "___AD_RAKUTEN"
<!-- Rakuten Dynamicad FROM HERE -->
<script type="text/javascript">
<!-- 
rakuten_template = "s_468_120_img";
rakuten_affiliateId = "04045295.c16d2b43.04045296.7e5300ec";
rakuten_service = "all";
rakuten_target = "_blank";
rakuten_color_bg = "FFFFFF";
rakuten_color_border = "CCCCCC";
rakuten_color_text = "000000";
rakuten_color_link = "0000FF";
rakuten_color_price = "CC0000";
//--></script>
<script type="text/javascript" src="http://dynamic.rakuten.co.jp/js/rakuten_dynamic.js"></script>
<!-- Rakuten Dynamicad TO HERE -->
___AD_RAKUTEN
	;
$ad_rakuten = "";

# インデックスページのテンプレート
$index_page_template = << "___INDEX_PAGE_TEMPLATE"
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="keywords" content="xight.org,情報視覚化,ChangeLogメモ" />
		<meta name="description" content="memo.xight.org - 日々のメモと情報視覚化について" />
		<meta name="author" content="Yoshiki Sato" />

		<link rel="canonical" href="http://memo.xight.org/" />
		<link rel="shortcut icon" href="http://xight.org/favicon.ico" />
		<link rel="icon" href="http://xight.org/favicon.ico" />
		<link rel="index" href="/" />
		<link rel="contents" href="/" />
		<link rel="start" href="/" />

		$css_html

		<!--[if IE]>
		<script type="text/javascript" src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->

		<link rel="alternate" type="application/rss+xml" title="RSS" href="/<TMPL_VAR name=rss_file>" />
		<script type="text/javascript">
		window.google_analytics_uacct = "UA-164286-2";
		</script>
		<script type="text/javascript" src="/common/amazon.js"></script>

		<title><TMPL_VAR name=cl_name></title>
		<meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1.6">
	</head>
	<body class="home blog single-author two-column right-sidebar">
		<div id="page">
			<header id="branding">
				$header_menu
			</header>
			<div id="main">
				<div id="primary">
					<div id="content">
						<TMPL_LOOP name=entries>
							<TMPL_VAR name=content>
						</TMPL_LOOP>
					</div>
				</div>
				<div id="secondary" class="widget-area">
					$side_menu
				</div>
			</div>
			<footer id="colophon">
				$footer_menu
			</footer>
		</div>
	</body>
</html>
___INDEX_PAGE_TEMPLATE
    ;

# 月ページのテンプレート
$month_page_template = << "___MONTH_PAGE_TEMPLATE"
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="keywords" content="xight.org,情報視覚化,ChangeLogメモ" />
		<meta name="description" content="memo.xight.org - <TMPL_VAR name=ym>のメモ" />
		<meta name="author" content="Yoshiki Sato" />

		<link rel="canonical" href="http://memo.xight.org/<TMPL_VAR name=ym>" />
		<link rel="shortcut icon" href="http://xight.org/favicon.ico" />
		<link rel="icon" href="http://xight.org/favicon.ico" />
		<link rel="index" href="/" />
		<link rel="contents" href="/" />
		<link rel="start" href="/" />
		<TMPL_IF name=back><link rel="prev" href="<TMPL_VAR name=back>" /></TMPL_IF>
		<TMPL_IF name=next><link rel="next" href="<TMPL_VAR name=next>" /></TMPL_IF>

		$css_html

		<!--[if IE]>
		<script type="text/javascript" src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->

		<link rel="alternate" type="application/rss+xml" title="RSS" href="/<TMPL_VAR name=rss_file>" />
		<script type="text/javascript">
		window.google_analytics_uacct = "UA-164286-2";
		</script>
		<script type="text/javascript" src="/common/amazon.js"></script>

		<title><TMPL_VAR name=cl_name> - <TMPL_VAR name=ym></title>
		<meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1.6">
	</head>
	<body class="home blog single-author two-column right-sidebar">
		<div id="page">
			<header id="branding">
				$header_menu
			</header>
			<div id="main">
				<nav class="breadcrumb">
					<ol>
						<li><a href="http://memo.xight.org/" title="memo.xight.org - Changelogメモ">memo.xight.org</a></li>
						<li><span class="here"><TMPL_VAR name=ym></span></li>
					</ol>
				</nav>
				<div id="primary">
					<div id="content">
						<nav class="sequential">
							<TMPL_IF name=back><a class="back" href="<TMPL_VAR name=back>">&laquo; 前の月</a></TMPL_IF>
							<TMPL_IF name=next><a class="next" href="<TMPL_VAR name=next>">次の月 &raquo;</a></TMPL_IF>
						</nav>
						<TMPL_LOOP name=entries>
							<TMPL_VAR name=content>
						</TMPL_LOOP>
						<nav class="sequential">
							<TMPL_IF name=back><a class="back" href="<TMPL_VAR name=back>">&laquo; 前の月</a></TMPL_IF>
							<TMPL_IF name=next><a class="next" href="<TMPL_VAR name=next>">次の月 &raquo;</a></TMPL_IF>
						</nav>
					</div>
				</div>

				<div id="secondary" class="widget-area">
					$side_menu
				</div>
			</div>
			<footer id="colophon">
				$footer_menu
			</footer>
		</div>
	</body>
</html>
___MONTH_PAGE_TEMPLATE
    ;

# 日ページのテンプレート
$day_page_template = << "___DAY_PAGE_TEMPLATE"
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="keywords" content="xight.org,情報視覚化,ChangeLogメモ" />
		<meta name="description" content="memo.xight.org - <TMPL_VAR name=ymd>のメモ" />
		<meta name="author" content="Yoshiki Sato" />

		<link rel="canonical" href="http://memo.xight.org/<TMPL_VAR name=ymd>" />
		<link rel="shortcut icon" href="http://xight.org/favicon.ico" />
		<link rel="icon" href="http://xight.org/favicon.ico" />
		<link rel="index" href="/" />
		<link rel="contents" href="/<TMPL_VAR name=ym>" />
		<link rel="start" href="/" />
		<TMPL_IF name=back><link rel="prev" href="<TMPL_VAR name=back>" /></TMPL_IF>
		<TMPL_IF name=next><link rel="next" href="<TMPL_VAR name=next>" /></TMPL_IF>

		$css_html

		<!--[if IE]>
		<script type="text/javascript" src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->

		<link rel="alternate" type="application/rss+xml" title="RSS" href="/<TMPL_VAR name=rss_file>" />
		<script type="text/javascript">
		window.google_analytics_uacct = "UA-164286-2";
		</script>
		<script type="text/javascript" src="/common/amazon.js"></script>

		<title><TMPL_VAR name=cl_name> - <TMPL_VAR name=ymd></title>
		<meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1.6">
	</head>
	<body class="home blog single-author two-column right-sidebar">
		<div id="page">
			<header id="branding">
				$header_menu
			</header>
			<div id="main">
				<nav class="breadcrumb">
					<ol>
						<li><a href="http://memo.xight.org/" title="memo.xight.org - Changelogメモ">memo.xight.org</a></li>
						<li><a href="<TMPL_VAR name=ym>"><TMPL_VAR name=ym></a></li>
						<li><span class="here"><TMPL_VAR name=ymd></span></li>
					</ol>
				</nav>
				<div id="primary">
					<div id="content">
						<nav class="sequential">
							<TMPL_IF name=back><a class="back" href="<TMPL_VAR name=back>">&laquo; 前の日</a></TMPL_IF>
							<TMPL_IF name=next><a class="next" href="<TMPL_VAR name=next>">次の日 &raquo;</a></TMPL_IF>
						</nav>
						<TMPL_VAR name=content>
						<nav class="sequential">
							<TMPL_IF name=back><a class="back" href="<TMPL_VAR name=back>">&laquo; 前の日</a></TMPL_IF>
							<TMPL_IF name=next><a class="next" href="<TMPL_VAR name=next>">次の日 &raquo;</a></TMPL_IF>
						</nav>
					</div>
				</div>

				<div id="secondary" class="widget-area">
					$side_menu
				</div>
			</div>
			<footer id="colophon">
				$footer_menu
			</footer>
		</div>
	</body>
</html>
___DAY_PAGE_TEMPLATE
    ;

# アイテムページのテンプレート
$item_page_template = << "___PAGE_TEMPLATE"
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="keywords" content="<TMPL_VAR name=header>,xight.org,情報視覚化,ChangeLogメモ" />
		<meta name="description" content="memo.xight.org - <TMPL_VAR name=header>" />
		<meta name="author" content="Yoshiki Sato" />

		<link rel="canonical" href="http://memo.xight.org/<TMPL_VAR name=ymdi>" />
		<link rel="shortcut icon" href="http://xight.org/favicon.ico" />
		<link rel="icon" href="http://xight.org/favicon.ico" />
		<link rel="index" href="/" />
		<link rel="contents" href="/<TMPL_VAR name=ymd>" />
		<link rel="start" href="/" />
		<TMPL_IF name=back><link rel="prev" href="<TMPL_VAR name=back>" /></TMPL_IF>
		<TMPL_IF name=next><link rel="next" href="<TMPL_VAR name=next>" /></TMPL_IF>

		$css_html

		<!--[if IE]>
		<script type="text/javascript" src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->

		<link rel="alternate" type="application/rss+xml" title="RSS" href="/<TMPL_VAR name=rss_file>" />
		<script type="text/javascript">
		window.google_analytics_uacct = "UA-164286-2";
		</script>
		<script type="text/javascript" src="/common/amazon.js"></script>

		<title><TMPL_VAR name=header_text> - <TMPL_VAR name=cl_name></title>
		<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=1.6">
	</head>
	<body class="home blog single-author two-column right-sidebar">
		<div id="page">
			<header id="branding">
				$header_menu
			</header>
			<div id="main">
				<nav class="breadcrumb">
					<ol>
						<li><a href="http://memo.xight.org/" title="memo.xight.org - Changelogメモ">memo.xight.org</a></li>
						<li><a href="<TMPL_VAR name=ym>"><TMPL_VAR name=ym></a></li>
						<li><a href="<TMPL_VAR name=ymd>"><TMPL_VAR name=ymd></a></li>
						<li><span class="here"><TMPL_VAR name=header_text></span></li>
					</ol>
				</nav>
				<!-- start:<TMPL_VAR name=ymdi> -->
				<!-- rakuten_ad_target_begin -->
				<!-- google_ad_section_start -->
				<div id="primary">
					<div id="content">
						<nav class="sequential">
							<TMPL_IF name=back><TMPL_IF name=header_text_before>
									<a class="back" href="<TMPL_VAR name=back>">&laquo; <TMPL_VAR name=header_text_before></a>
							</TMPL_IF></TMPL_IF>
							<TMPL_IF name=next><TMPL_IF name=header_text_after>
									<a class="next" href="<TMPL_VAR name=next>"><TMPL_VAR name=header_text_after> &raquo;</a>
							</TMPL_IF></TMPL_IF>
						</nav>
<!-- start:<TMPL_VAR name=ymdi> -->
<article class="post type-post status-publish format-standard hentry">
	<header class="entry-header">
		<h1 class="entry-title"><TMPL_VAR name=header></h1>
		<div class="entry-meta">
			<span class="sep">Posted on </span><time class="entry-date" datetime="<TMPL_VAR name=ymd>"><TMPL_VAR name=ymd></time>
			<TMPL_IF name=cat>
			<span class="sep"> | </span>
			<span class="tag-links">
				<span class="entry-utility-prep entry-utility-prep-tag-links">Tagged</span>
				<span class="sep"> : </span>
				<TMPL_VAR name=cat>
			</span>
			</TMPL_IF>
		</div>
	</header>

	<article class="ad">
	$ad_486_60
	</article>

	<div class="entry-content">
		<TMPL_VAR name=content>
	</div>
	<footer class="entry-meta">
		<span class="sep">Posted on </span><time class="entry-date" datetime="<TMPL_VAR name=ymd>"><TMPL_VAR name=ymd></time>
		<span class="by-author">
			<span class="sep">by</span>
			<span class="author vcard">
				<a class="url fn n" href="https://plus.google.com/106184954874731012420" title="Yoshiki Sato" rel="author">Yoshiki Sato</a></span></span>
		<!--
		<span class="cat-links">
			<span class="entry-utility-prep entry-utility-prep-cat-links">Posted in</span>
			<a href="http://wp-themes.com/?cat=1" title="View all posts in Uncategorized" rel="category">Uncategorized</a>
		</span>
		<span class="sep"> | </span>
		-->
		<TMPL_IF name=cat>
		<span class="sep"> | </span>
		<span class="tag-links">
			<span class="entry-utility-prep entry-utility-prep-tag-links">Tagged</span>
			<span class="sep"> : </span>
			<TMPL_VAR name=cat>
		</span>
		</TMPL_IF>

		<TMPL_IF name=referrer>
		<span class="sep"> | </span>
		<span class="inner-links">
			<span class="entry-utility-prep entry-utility-prep-tag-links">Inner link</span>
			<span class="sep"> : </span>
			<TMPL_VAR name=referrer>
		</span>
		</TMPL_IF>
	</footer>
	<!--<TMPL_VAR name=id>-->
</article>
					<article class="ad">
					$ad_336_280
					</article>

					<article class="ad">
					$ad_rakuten
					</article>

					</div>
				</div>
				<!-- google_ad_section_end -->
				<!-- rakuten_ad_target_end -->
				<!-- end:<TMPL_VAR name=ymdi> -->

				<div id="secondary" class="widget-area">
					$side_menu
				</div>
			</div>
			<footer id="colophon">
				$footer_menu
			</footer>
		</div>
	</body>
</html>
___PAGE_TEMPLATE
	;

# カテゴリページのテンプレート
$cat_page_template = << "___CAT_TEMPLATE"
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="keywords" content="<TMPL_VAR name=cat_name>,xight.org,情報視覚化,ChangeLogメモ" />
		<meta name="description" content="memo.xight.org のカテゴリ - <TMPL_VAR name=cat_name>" />
		<meta name="author" content="Yoshiki Sato" />

		<link rel="canonical" href="http://memo.xight.org/<TMPL_VAR name=first_page>" />
		<link rel="shortcut icon" href="http://xight.org/favicon.ico" />
		<link rel="icon" href="http://xight.org/favicon.ico" />
		<link rel="index" href="/" />
		<link rel="contents" href="/" />
		<link rel="start" href="/<TMPL_VAR name=first_page>" />
		<TMPL_IF name=back><link rel="prev" href="<TMPL_VAR name=back>" /></TMPL_IF>
		<TMPL_IF name=next><link rel="next" href="<TMPL_VAR name=next>" /></TMPL_IF>

		$css_html

		<!--[if IE]>
		<script type="text/javascript" src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->

		<link rel="alternate" type="application/rss+xml" title="RSS" href="/<TMPL_VAR name=rss_file>" />
		<script type="text/javascript">
		window.google_analytics_uacct = "UA-164286-2";
		</script>
		<script type="text/javascript" src="/common/amazon.js"></script>

		<title><TMPL_VAR name=cat_name> - <TMPL_VAR name=cl_name></title>
		<meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1.6">
	</head>
	<body class="home blog single-author two-column right-sidebar">
		<div id="page">
			<header id="branding">
				$header_menu
			</header>
			<div id="main">
				<nav class="breadcrumb">
					<ol>
						<li><a href="http://memo.xight.org/" title="memo.xight.org - Changelogメモ">memo.xight.org</a></li>
						<li><span class="here"><TMPL_VAR name=cat_name></span></li>
					</ol>
				</nav>

				<div id="primary">
					<div id="content">
						<nav class="pager">
							<ul class="pager">
							<TMPL_IF name=back>
								<li class="back"><a class="back" href="<TMPL_VAR name=back>">&laquo;</a></li>
							</TMPL_IF>
							<TMPL_IF name=page_list>
								<TMPL_VAR name=page_list>
							</TMPL_IF>
							<TMPL_IF name=next>
								<li class="next"><a class="next" href="<TMPL_VAR name=next>">&raquo;</a></li>
							</TMPL_IF>
							</ul>
						</nav>
						<header class="entry-header">
							<h1 class="entry-title">カテゴリ : <TMPL_VAR name=cat_name></h1>
							<TMPL_VAR name=page_id>ページ目 / 全<TMPL_VAR name=page_num>ページ
						</header>
<!-- start:<TMPL_VAR name=ymdi> -->

						<TMPL_LOOP name=entries>
							<TMPL_VAR name=cont>
						</TMPL_LOOP>

						<nav class="pager">
							<ul class="pager">
							<TMPL_IF name=back>
								<li class="back"><a class="back" href="<TMPL_VAR name=back>">&laquo;</a></li>
							</TMPL_IF>
							<TMPL_IF name=page_list>
								<TMPL_VAR name=page_list>
							</TMPL_IF>
							<TMPL_IF name=next>
								<li class="next"><a class="next" href="<TMPL_VAR name=next>">&raquo;</a></li>
							</TMPL_IF>
							</ul>
						</nav>
					</div>
				</div>

				<div id="secondary" class="widget-area">
					$side_menu
				</div>
			</div>
			<footer id="colophon">
				$footer_menu
			</footer>
		</div>
	</body>
</html>
___CAT_TEMPLATE
    ;

# item のテンプレート
$item_template = << "EACHITEM"
<!-- start:<TMPL_VAR name=ymdi> -->
<article class="post type-post status-publish format-standard hentry">
	<header class="entry-header">
		<h1 class="entry-title"><a href="<TMPL_VAR name=url>"><TMPL_VAR name=header></a></h1>
		<div class="entry-meta">
			<span class="sep">Posted on </span><time class="entry-date" datetime="<TMPL_VAR name=ymd>"><TMPL_VAR name=ymd></time>
			<span class="sep"> | </span>
			<TMPL_IF name=cat>
			<span class="tag-links">
				<span class="entry-utility-prep entry-utility-prep-tag-links">Tagged</span>
				<span class="sep"> : </span>
				<TMPL_VAR name=cat>
			</span>
			</TMPL_IF>
		</div>
	</header>
	<div class="entry-content">
		<TMPL_VAR name=content>
	</div>
	<footer class="entry-meta">
		<span class="sep">Posted on </span><time class="entry-date" datetime="<TMPL_VAR name=ymd>"><TMPL_VAR name=ymd></time>
		<span class="by-author">
			<span class="sep">by</span>
			<span class="author vcard">
				<a class="url fn n" href="https://plus.google.com/106184954874731012420" title="Yoshiki Sato" rel="author">Yoshiki Sato</a></span></span>
		<!--
		<span class="cat-links">
			<span class="entry-utility-prep entry-utility-prep-cat-links">Posted in</span>
			<a href="http://wp-themes.com/?cat=1" title="View all posts in Uncategorized" rel="category">Uncategorized</a>
		</span>
		<span class="sep"> | </span>
		-->
		<TMPL_IF name=cat>
		<span class="sep"> | </span>
		<span class="tag-links">
			<span class="entry-utility-prep entry-utility-prep-tag-links">Tagged</span>
			<span class="sep"> : </span>
			<TMPL_VAR name=cat>
		</span>
		</TMPL_IF>

		<TMPL_IF name=referrer>
		<span class="sep"> | </span>
		<span class="inner-links">
			<span class="entry-utility-prep entry-utility-prep-tag-links">Inner link</span>
			<span class="sep"> : </span>
			<TMPL_VAR name=referrer>
		</span>
		</TMPL_IF>
	</footer>
	<!--<TMPL_VAR name=id>-->
</article>
<!-- end:<TMPL_VAR name=ymdi> -->
<!-- ReplaceOnce -->
EACHITEM
    ;

# entry (date) のテンプレート
$entry_template = << "DAYENTRY"
<TMPL_VAR name=content>
<TMPL_IF name=referrer>
<!--
<footer class="entry-meta">
	<span class="inner-links">
		<span class="entry-utility-prep entry-utility-prep-tag-links">Inner link</span>
		<TMPL_VAR name=referrer>
	</span>
</footer>
-->
</TMPL_IF>
DAYENTRY
    ;

# 1}}}

## プラグイン {{{1

### コメントアウト
# usage: {{com('これは HTML 変換時に削られます')}}
sub com { }

### embed gist
# usage: {{gist('db545f675c448ff14030')}}
sub gist {
    my ($id) = @_;
	my $user = q(xight);
    return qq(<script src="https://gist.github.com/${user}/${id}.js"></script>);
}

### clsearch キーワード検索 URL 作成
# usage: {{clsearch('海老名 映画館')}}
# usage: {{clsearch('海老名 映画館', 1)}}
sub clsearch {
    my ($k, $mode) = @_;
    my $o = $k;
    $k =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
    $k =~ s/\s/+/g;
    $mode = "&amp;mode=$mode" if (defined $mode);
    return qq(<a href="clsearch.cgi?key=$k$mode" title="ChangeLogメモ検索 - $o">$o</a>);
}

### google キーワード検索 URL 作成
# usage: {{google_search('海老名 映画館')}}
sub google_search {
    my ($k) = @_;
    my $o = $k;
    $k =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
    $k =~ s/\s/+/g;
    my $c = "ie=EUC-JP&amp;oe=EUC-JP&amp;";
    return qq(<a href="http://www.google.co.jp/search?${c}q=$k" title="Google検索 - $o">$o</a>);
}

### Bulkfeeds キーワード検索
# usage: {{bulkfeeds('海老名 映画')}}
sub bulkfeeds {
    my ($k) = @_;
    my $o = $k;
    $k = Jcode->new($k)->utf8;
    $k =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
    $k =~ s/\s/+/g;
    return qq(<a href="http://bulkfeeds.net/app/search2?q=$k" title="Bulkfeeds検索 - $o">$o</a>);
}

### Wiki へのリンクの作成
# usage: {{wiki_link('WIKINAME')}}
sub wiki_link {
    my ($k, $o) = @_;
    my $prefix = "http://nais.to/hiki/hiki.cgi?";
    $o = $k if (not defined $o);
    $k =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
    $k =~ s/\s/+/g;
    return qq(<a href="$prefix$k" title="Wiki - $o">$o</a>);
}

### amazon リンクの作成
# usage: {{amazon('ASIN', 'STR')}}
sub _amazon {
    my ($asin, $str) = @_;
    my $prefix = "http://www.amazon.co.jp/exec/obidos/ASIN";
    my $suffix = "xight-22/ref=nosim"; # アソシID使用時
    $str =~ s/(\s|^)(\S+\.(jpg|jpeg|png|gif))/$1<img src="$2">/gi;
    $str =~ s/$/<br \/>/gm;
    $str =~ s/<br \/>\Z//m;
    return qq(<a href="$prefix/$asin/$suffix" title="$str">$str</a>);
}
sub amazon {
    my ($asin, $str) = @_;
	my $aid    = "xight-22";
    my $prefix = "http://www.amazon.co.jp/gp/product";
    my $suffix = "&id=UTF8&linkCode=as2&camp=247&creative=1211";
	my $ret    = '';
	$ret .= qq(<a href="$prefix/$asin?tag=$aid&creativeASIN=$asin$suffix" title="$str">$str</a>);
	$ret .= qq(<img src="http://www.assoc-amazon.jp/e/ir?t=$aid&l=as2&o=9&a=$asin" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />);
    return $ret;
}

### amazon リンクの作成 (画像タイトル付き)
# usage: {{amazon_image('ASIN', 'Title', 'num')}}
sub _amazon_image {
    my ($asin, $title, $num) = @_;
    my $prefix = "http://www.amazon.co.jp/exec/obidos/ASIN";
    my $suffix  = "xight-22/ref=nosim"; # アソシID使用時
	my $prefix2 = "http://images-jp.amazon.com/images/P";
	my $suffix2 ="MZZZZZZZ.jpg";
	if ($num ne '01'){
		$num = '09';
	}
    return qq(<a href="$prefix/$asin/$suffix" title="$title"><img src="$prefix2/$asin.$num.$suffix2" alt="Amazon - $title" onload="replaceImage(this)" /></a>);
}
sub amazon_image {
    my ($asin, $str, $num) = @_;
	my $aid    = "xight-22";
    my $prefix = "http://www.amazon.co.jp/gp/product";
    my $suffix = "&id=UTF8&linkCode=as2&camp=247&creative=1211";
	my $prefix2 = "http://images-jp.amazon.com/images/P";
	my $suffix2 ="MZZZZZZZ.jpg";
	if ($num ne '01'){
		$num = '09';
	}

	my $ret    = '';

	$ret .= qq(<a href="$prefix/$asin?tag=$aid&creativeASIN=$asin$suffix" title="$str">);
    $ret .= qq(<img src="$prefix2/$asin.$num.$suffix2" alt="Amazon - $str" onload="replaceImage(this)" />);
	$ret .= qq(</a>);
    return $ret;
}

### bk1 リンクの作成 - ISBN検索
# usage: {{bk1('ISBN')}}
sub bk1 {
    my ($isbn) = @_;
    my $aid = "p-137467927";
    return qq(<a href="http://breeder.bk1.jp/rd/$isbn/$aid/noentry" title="bk1 ISBN検索 - $isbn">[bk1]</a>);
}

sub az {amazon(@_)}
sub azs {amazon_search(@_)}
sub bf {bulkfeeds(@_)}
sub cls {clsearch(@_)}
sub gs {google_search(@_)}

### amazon サーチ結果リンクの作成
# usage: {{amazon_search('STR' [,'MODE'])}}
sub amazon_search {
    my ($str, $mode) = @_;
    my $k = Jcode->new($str)->utf8;
    $k =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
    $k =~ s/\s/+/g;
    my $aid = "xight-22";
    $mode = "blended" if not defined $mode;
    return '<a href="http://www.amazon.co.jp/exec/obidos/external-search'.
        "?tag=$aid&amp;keyword=$k&amp;mode=$mode\" title=\"Amazon検索 - $str\">$str</a>";
}

### 普通の amazon アソシエイトリンクの作成
# usage: {{amazon_link('ASIN', 'ID', 'STR')}}
sub amazon_link {
    my ($asin, $id, $str) = @_;
    my $prefix = "http://www.amazon.co.jp/exec/obidos/ASIN";
    $str =~ s/(\s|^)(\S+\.(jpg|jpeg|png|gif))/$1<img src="$2">/gi;
    $str =~ s/$/<br \/>/gm;
    $str =~ s/<br \/>\Z//m;
    return qq(<a href="$prefix/$asin/$id/ref=nosim" title="Amazon - $str">$str</a>);
}

### 後ろめたい amazon アソシエイトリンクの作成
# ref. <http://chalow.net/2003-11-06.html#2003-11-06-2>
# usage: {{qualmish_amazon_link('ASIN', 'ID', 'STR')}}
sub qualmish_amazon_link {
    my ($asin, $id, $str) = @_;
    my $prefix = "http://www.amazon.co.jp/exec/obidos/ASIN";
    $str =~ s/(\s|^)(\S+\.(jpg|jpeg|png|gif))/$1<img src="$2">/gi;
    $str =~ s/$/<br \/>/gm;
    $str =~ s/<br \/>\Z//m;
    return qq(<a href="$prefix/$asin/$id/ref=nosim" title="Amazon - $str"
	      onMouseOver="window.status='$prefix/$asin'; return true;"
	      onMouseOut="window.status=''; return true;">$str</a>);
}

### URL を短く表示
# usage: {{shorten_url('http://example.com/abc/def/00101033/
# 0123456/aaaaaaaaaaaa/aaaaaaaaaaaa/index.html')}}
sub shorten_url {
    my ($url, $max) = @_;
    $max = 60 if not defined $max;
    $url =~ s/\s+//gsm;
    my $urlstr = $url;
    $urlstr =~ s/^(.{$max}).+$/$1 .../;
    return qq(<a href="$url">$urlstr</a>);
}

### カテゴリページへのリンク
# usage: {{cat('プログラミング')}}
sub cat {
    my ($cn) = @_;
    my $url = get_category_filename($cn);
    return qq(<a href="$url" title="カテゴリ - $cn">$cn</a>);
}

### はてなダイアリーの検索へのリンク
# usage: {{hatena_search('hatena-ID','Keyword')}}
sub hatena_search {
	my ($id,$keyword) = @_;
	my $prefix = q(http://d.hatena.ne.jp);
	my $enc    = $keyword;
	$enc =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
	$enc =~ s/\s/+/g;
	return qq(<a href="$prefix/$id/searchdiary?word=$enc" title="はてなダイアリー - $id - $keyword">$id - $keyword</a>);
}
### はてなダイアリーのキーワードへのリンク
sub hatena_keyword {
	my ($keyword) = @_;
	my $prefix = q(http://d.hatena.ne.jp/keyword);
	my $enc    = $keyword;
	$enc =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
	$enc =~ s/\s/+/g;
	return qq(<a href="$prefix/$enc" title="はてなダイアリー - $keywordとは">はてなダイアリー - $keywordとは</a>);
}

### はてなダイアリーへのリンク (ID)
sub hatena_id {
	my ($id) = @_;
	my $prefix = q(http://d.hatena.ne.jp/);
	return qq(<a href="$prefix/$id" title="はてなダイアリー - $id">はてなダイアリー - $id</a>);
}

### CPAN Moduleの検索リンク
# usage: {{cpan_search('Keyword','mode')}}
# mode : dist   - Search in Distributions
#        module - Search in Modules (default)
sub cpan_search {
	my ($word,$mode) = @_;
	my $prefix = q(http://search.cpan.org);
	if ($mode ne 'dist' && $mode ne 'module' && $mode ne 'all'){
		$mode = 'all';
	}
	return qq(<a href="$prefix/search?m=$mode&amp;q=$word" title="CPAN - $word">$word</a>);
}
sub cpan{cpan_search(@_)}

### PEAR Moduleの検索リンク
# usage: {{pear_search('pkg_name')}}
sub pear_search {
    my ($word) = @_;
    my $prefix = q(http://pear.php.net);
    return qq(<a href="$prefix/search.php?q=$word&in=packages" title="PEAR Search - $word">$word</a>);
}
sub pear{pear_search(@_)}

### MapFanへのリンク
# usage: {{mapfan('東京都○○区○町00-0')}}
sub mapfan {
	my ($str) = @_;
	my $prefix = q(http://www.mapfan.com);
	my $enc    = $str;
	$enc =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
	$enc =~ s/\s/+/g;
	return qq(<a href="$prefix/index.cgi?ADDR=$enc" title="Map Fan - $str">$str</a>);
}
### MapFanへのスポット名検索リンク
# usage: {{mapfan_search('スポット名')}}
sub mapfan_search {
	my ($str) = @_;
	my $prefix = q(http://www.mapfan.com);
	my $enc    = $str;
	$enc =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
	$enc =~ s/\s/+/g;
	return qq(<a href="$prefix/keywordsrch.cgi?SRCHKIND=SRCH_NAME&amp;PARAM=$enc" title="Map Fan - スポット名検索 - $str">$str</a>);
}
### MapionBBへのリンク
# usage: {{mapion('東京都○○区○町00-0')}}
sub mapion {
	my ($str) = @_;
	my $prefix = q(http://www.mapion.co.jp/c/);
	my $enc    = $str;
	$enc =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
	$enc =~ s/\s/+/g;
	return qq(<a href="$prefix/f?uc=7&amp;grp=MapionBB&amp;find=$enc" title="Mapion BB - $str">$str</a>);
}
### MapionBBへのランドマーク検索リンク
# usage: {{mapion_search('ランドマーク')}}
sub mapion_search {
	my ($str) = @_;
	my $prefix = q(http://www.mapion.co.jp/c/);
	my $enc    = $str;
	$enc =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
	$enc =~ s/\s/+/g;
	return qq(<a href="$prefix/f?uc=12&amp;grp=MapionBB&amp;find=$enc" title="Mapion BB - ランドマーク検索 - $str">$str</a>);
}
### Debian バイナリパッケージ検索へのリンク
# usage: {{debian('パッケージ名')}}
sub debian {
	my ($str) = @_;
	my $prefix = q(http://packages.debian.org);
	return qq(<a href="$prefix/$str" title="Debian パッケージディレクトリ検索 (バイナリ) - $str">Debian パッケージディレクトリ検索 (バイナリ) - $str</a>);
}
### Debian ソースパッケージ検索へのリンク
# usage: {{debian_src('パッケージ名')}}
sub debian_src {
	my ($str) = @_;
	my $prefix = q(http://packages.debian.org);
	return qq(<a href="$prefix/src:$str" title="Debian パッケージディレクトリ検索 (ソース) - $str">Debian パッケージディレクトリ検索 (ソース) - $str</a>);
}
### Debian パッケージ内容検索へのリンク
# usage: {{debian_search('keyword')}}
sub debian_search {
	my ($str) = @_;
	my $prefix = q(http://packages.debian.org/cgi-bin);
	# $version は stable, testing, unstable で指定
	my $version = q(all);
	# $arch は 以下で指定．
	# i386      : Intel x86
	# m68k      : Motorola 680x0
	# alpha     : Alpha
	# sparc     : SPARC
	# powerpc   : PowerPC
	# arm       : ARM
	# hppa      : HP PA/RISC
	# ia64      : Intel IA-64
	# mips      : MIPS
	# mipsel    : MIPS (DEC)
	# s390      : IBM S/390
	# hurd-i386 : Hurd (i386)
	my $arch = q(i386);
	return qq(<a href="$prefix/search_contents.pl?word=$str&amp;searchmode=searchfiles&amp;version=$version&amp;arch=$arch" title="Debian パッケージ内容検索 - $str">Debian パッケージ内容検索 - $str</a>);
}
### Debian Package Tracking System
# usage: {{debian_qa('パッケージ名')}}
sub debian_qa {
	my ($str) = @_;
	my $prefix = q(http://packages.qa.debian.org);
	return qq(<a href="$prefix/$str" title="Debian Package Tracking System - $str">Debian Package Tracking System - $str</a>);
}
### PHP 関数検索へのリンクプラグイン
# usage: {{php('関数名')}}
sub php {
	my ($str) = @_;
	my $prefix = q(http://www.php.net);
	my $lang = q(ja);
	# quickref  : function list
	# wholesite : whole site
	# manual    : online documentation [en]
	# bugdb     : bug database
	# maillist  : general mailing list
	# devlist   : developer mailing list
	# phpdoc    : documentation mailing list 
	my $show = q(quickref);
	return qq(<a href="$prefix/search.php?pattern=$str&amp;lang=$lang&amp;show=$show" title="PHP Manual - $str">PHP Manual - $str</a>);
}

### Wikipedia へのリンクプラグイン
# usage: {{wikipedia('word','country')}}
sub wikipedia {
	my $default = 'ja';
	my ($str,$country) = @_;

	if (!defined($country)){
		$country = $default;
	}

	my $prefix = qq(http://$country.wikipedia.org/wiki);
	my $enc = URI::Escape::uri_escape(Jcode->new($str)->utf8);
	# my $enc = Jcode->new($str)->utf8;
	# $enc =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
	# $enc =~ s/\s/+/g;
	return qq(<a href="$prefix/$enc" title="Wikipedia ($country) - $str">Wikipedia - $str</a>);

}
sub uncyclopedia {
	my ($str) = @_;

	my $prefix = qq(http://ja.uncyclopedia.info/wiki);
	my $enc = URI::Escape::uri_escape(Jcode->new($str)->utf8);
	return qq(<a href="$prefix/$enc" title="Uncyclopedia - $str">Uncyclopedia - $str</a>);

}


### Google 画像検索へのリンクプラグイン
# usage: {{google_image('キーワード')}}
sub google_image {
	my ($str) = @_;
	my $prefix = q(http://images.google.com/images?q=);
	my $enc = URI::Escape::uri_escape(Jcode->new($str)->utf8);
	# my $enc = Jcode->new($str)->utf8;
	# $enc =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
	# $enc =~ s/\s/+/g;
	return qq(<a href="$prefix$enc" title="Google Images - $str">Google 画像検索 - $str</a>);
}

### Google Music 検索へのリンクプラグイン
# usage: {{google_music('キーワード')}}
sub google_music {
	my ($str) = @_;
	my $prefix = q(http://www.google.com/musicsearch?q=);
	return qq(<a href="$prefix$str" title="Google Music - $str">Google 音楽検索 - $str</a>);
}

### Google Video 検索へのリンクプラグイン
# usage: {{google_video('keyword')}}
sub google_video{
	my ($str) = @_;
	my $prefix = q(http://video.google.com/videosearch?q=);
	return qq(<a href="$prefix$str" title="Google Video - $str">Google 動画検索 - $str</a>);
}
### Google Mapsへのリンク
# usage: {{google_maps('住所 (店名など)')}}
sub google_maps {
	my ($str) = @_;
	my $prefix = q(http://maps.google.co.jp/maps?q=);
	my $enc = URI::Escape::uri_escape(Jcode->new($str)->utf8);
    # my $enc = Jcode->new($str)->utf8;
	# $enc =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
	# $enc =~ s/\s/+/g;
	return qq(<a href="$prefix$enc" title="Google Maps - $str">$str</a>);
}
sub maps {google_maps(@_)}

### Google Mapsの埋め込み
# usage: {{embed_google_maps('住所 (店名など)')}}
sub embed_google_maps {
	my ($str) = @_;
	my $prefix = q(http://maps.google.co.jp/maps?q=);
	my $enc = URI::Escape::uri_escape(Jcode->new($str)->utf8);
	my $width = 600;
	my $height = 400;
	return qq(<iframe width="$width" height="$height" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="$prefix$enc&amp;output=embed"></iframe>);
}

sub embed_maps {embed_google_maps(@_)}

### 104.com 無料電話番号案内へのリンク
# usage: {{tel_search('03-0000-0000')}}
sub tel_search {
	my ($str) = @_;
	my ($prefix) = q(http://104.com/wtel/name?nm=);
	return qq(<a href="$prefix$str" title="電話番号検索 - $str">$str</a>);
}
sub tel {tel_search(@_)}

### 駅前探検倶楽部へのリンク
# usage: {{ekitan('中板橋')}}
sub ekitan {
	my ($str) = @_;
	my $prefix = q(http://transit.ekitan.com/norikae/NorikaeSearch?STNAME=);

	# URI::Escape
	my $enc = URI::Escape::uri_escape(Jcode->new($str)->sjis);
	return qq(<a href="$prefix$enc" title="駅探検索 - $str着">$str</a>);
}
sub station {ekitan(@_)}

### キーボード
# usage: {{keyboard('Ctrl','Alt','Del')}}
sub keyboard {
	my @result = map {'<kbd>'.$_.'</kbd>'} @_;
	return join('+',@result);
}

### YouTube
# usage: {{youtube('YouTube のパラメタ (v=) の値')}}
sub youtube {
	my ($id) = @_;
	return qq(<object width="425" height="350">
	<param name="movie" value="http://www.youtube.com/v/$id"></param>
	<embed src="http://www.youtube.com/v/$id" type="application/x-shockwave-flash" width="425" height="350"></embed>
	</object>);

}
sub youtube_image {
	my ($id) = @_;
	return qq(
	<a href="http://www.youtube.com/watch?v=$id"><img src="http://sjl-static1.sjl.youtube.com/vi/$id/1.jpg" width="130" height="97" /></a>
	<a href="http://www.youtube.com/watch?v=$id"><img src="http://sjl-static1.sjl.youtube.com/vi/$id/2.jpg" width="130" height="97" /></a>
	<a href="http://www.youtube.com/watch?v=$id"><img src="http://sjl-static1.sjl.youtube.com/vi/$id/3.jpg" width="130" height="97" /></a>
	);
}

######################
# embed nicovideo movie
# usage: {{nicovideo('id','title')}}
sub nicovideo {
	my ($id,$title) = @_;
	return qq(
	<script type="text/javascript" src="http://ext.nicovideo.jp/thumb_watch/$id"></script>
	<noscript><a href="http://www.nicovideo.jp/watch/$id" target="_blank">$title</a></noscript>
	);
}


######################
# embed vimeo movie
# usage: {{vimeo('id','width','height')}}
sub vimeo {
	my ($id,$width,$height) = @_;
	return qq(<object width="$width" height="$height">
	<param name="allowfullscreen" value="true" />
	<param name="allowscriptaccess" value="always" />
	<param name="movie" value="http://vimeo.com/moogaloop.swf?clip_id=$id&amp;server=vimeo.com&amp;show_title=1&amp;show_byline=1&amp;show_portrait=0&amp;fullscreen=1" />
	<embed src="http://vimeo.com/moogaloop.swf?clip_id=$id&amp;server=vimeo.com&amp;show_title=1&amp;show_byline=1&amp;show_portrait=0&amp;fullscreen=1" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="$width" height="$height">
	</embed>
	</object>);
}
######################
# embed swf 
# usage: {{swf('url','width','height')}}
sub swf{
	my ($url,$width,$height) = @_;
	return qq(<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,29,0" width="$width" height="$height">
<param name="movie" value="$url" />
<param name="quality" value="high" />
<param name="wmode" value="transparent" />
<embed src="$url" quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" wmode="transparent" width="$width" height="$height"></embed>
</object>);
}

### Smarty
# usage: {{smarty('検索語')}}
sub smarty {
	my ($str) = @_;
	my $prefix = 'http://smarty.php.net/manual/en/search.php?query=';
	my $enc = URI::Escape::uri_escape($str);
	return qq(<a href="$prefix$enc">$str</a>);
}

### よかった探しリース
# usage: {{hyuki_wreath('id')}}
sub hyuki_wreath {
	my ($id) = @_;
	my $prefix = 'http://www4023ui.sakura.ne.jp:8888';
	my $left   = qq($prefix/left/$id);
	my $right  = qq($prefix/right/$id);

	return qq(
			<a href="$left">&laquo; 左手</a>
	        <a href="http://www.hyuki.com/ring">よかった探しリース</a>
			<a href="$right">右手 &raquo;</a>
			);
}

######################
# 勝手に ALPSLAB clips! for chalow
#my $ping_data = '/home/hoge/tb/ping_data'; # 書き込み可能なディレクトリを指定
my $alps_chalow_version = '0.03';

sub alps_map {
	use CGI;
	use Jcode;
	my ($address, $option) = @_;

	if ($address =~ /[^0-9\-\/\.\,]/) {
		my $str = CGI::escapeHTML($address);

		my $adr = Jcode->new($str)->euc;
		$adr   = urlencode($adr);

		# XXX: option チェックをもうちょっとした方がいいかも
		my $opt = CGI::escapeHTML($option);

		return qq(<a href="http://clip.alpslab.jp/bin/rd?adr=$adr"><img class="alpslab-clip" src="http://clip.alpslab.jp/bin/map?adr=$adr&amp;opt=$opt" alt="ALPSLAB clip! - $str" /></a>);

	} else {
		my $str   = $address;
		my $opt = CGI::escapeHTML($option);
		return qq(<a href="http://clip.alpslab.jp/bin/rd?pos=$str"><img class="alpslab-clip" src="http://clip.alpslab.jp/bin/map?pos=$str&amp;opt=$opt" alt="ALPSLAB clip! - $str" /></a>);

	}
}
######################
# itms へのリンク
# usage: {{itms('app_name','app_id')}}
sub itms {
    my ($app,$id) = @_;
    my $prefix = q(itms://itunes.apple.com/WebObjects/MZStore.woa/wa/viewSoftware?id=);
    return qq(<a href="$prefix$id">$app</a>);
}

######################
# App Storeの情報を得る
# usage: {{app_store('id','key')}}
sub app_store {
    my ($id,$key) = @_;
	my $iTunes_viewSoftware = q(/home/yoshiki/bin/iTunes_viewSoftware/iTunes_viewSoftware.php);
	my $ret = `$iTunes_viewSoftware $id $key`;
	return $ret;
}
######################
# App Storeの情報を得る - LinkShareURL
# usage: {{app_store_linkshare('id')}}
sub app_store_linkshare {
    my ($id) = @_;
	return app_store($id,'LINKSHARE_URL');
}

######################
# Webページのスクリーンショットを挿入する
# usage: {{screenshot('URL')}}
sub screenshot{
    my ($url) = @_;
	my $width = 400;
	my $enc = URI::Escape::uri_escape($url);
	#return qq(<img src="http://s.wordpress.com/mshots/v1/$enc?w=$width">);
	return qq(<a href="$url"><img src="http://s.wordpress.com/mshots/v1/$enc?w=$width"></a>);
}

######################
# SlideShare
# usage: {{slideshare('embed code','start slide')}}
sub slideshare{
    my ($embed_code,$start_slide) = @_;
	my $width = 595;
	my $height = 485;
	return qq(<iframe src="//www.slideshare.net/slideshow/embed_code/key/$embed_code?startSlide=$start_slide" width="$width" height="$height" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen></iframe>);
}

######################

### TTYshare
# usage: {{ttyshare('val')}}
sub ttyshare{
	my ($id) = @_;
	return qq(<object width="480" height="288">
	<param name="movie" value="http://ttyshare.com/t/$id"></param>
	<embed src="http://ttyshare.com/t/$id" type="application/x-shockwave-flash" width="480" height="288"></embed>
	</object>);
}

### Puyo Simu
# usage: {{puyo('val')}}
sub puyo{
	my ($id) =@_;
	my $prefix =q(http://1st.geocities.jp/mattulwan/puyo_simulator/view.html);
	my $width = 128;
	my $height = 270;
	return qq(<iframe src="$prefix?$id" width="$width" height="$height" frameborder="0" scrolling="no"></iframe>);
}

sub to_msec{
	my $r = 0;
	my @tmp = split(/\//,shift);
	for(my $i=0;$i<@tmp;$i++){
		$r += $tmp[$i]/(60.0**$i);
	}
	int($r*3600000.0);
}
# }}}1

# vim: set fdm=marker commentstring=;#%s:
